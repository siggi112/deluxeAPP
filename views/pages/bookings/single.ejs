<%- include ../../temp/header.ejs %>
<%- include ../../temp/nav.ejs %>
<div class="page-content d-flex align-items-stretch">
<%- include ../../temp/sidebar.ejs %>
<div class="content-inner active" style="padding-bottom: 59px;">
          <!-- Page Header-->
          <header class="page-header">
                      <div class="container-fluid">
                        <h2 class="no-margin-bottom"><%= booking.firstname %> <%= booking.lastname %> - <%= booking.status %></h2>
                      </div>
          </header>

          <div class="breadcrumb-holder container-fluid">
            <div class="row">
              <div class="col-md-6 col-xs-12">
                <ul class="breadcrumb">
                  <li class="breadcrumb-item"><a href="/bookings">Bookings</a></li>
                  <li class="breadcrumb-item active"><%= booking.firstname %> <%= booking.lastname %></li>
                </ul>
              </div>
                <div class="col-md-6 col-xs-12">
                  <div class="float-right-actions">
                    <div class="dropdown">
          <button class="btn btn-outline-dark btn-sm" type="button" id="editBooking" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="fa fa-pencil"></span> Edit
          </button>
          <div class="dropdown-menu" aria-labelledby="editBooking">
            <a class="dropdown-item" data-toggle="modal" data-target="#editModal">Edit Contact details</a>
            <a class="dropdown-item" data-toggle="modal" data-target="#editTraveller">Edit Travellers List</a>
          </div>
        </div>
                  </div>
                  <div class="float-right-actions">
                    <div class="dropdown">
          <button class="btn btn-success btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="fa fa-plus"></span> Add
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" data-toggle="modal" data-target="#newPayment">New Payment</a>
            <a class="dropdown-item" data-toggle="modal" data-target="#newTraveller">New Traveller</a>
            <a class="dropdown-item" data-toggle="modal" data-target="#newPackage">New Package</a>
            <a class="dropdown-item" data-toggle="modal" data-target="#newTransfer">New Transfer</a>
              <a class="dropdown-item" data-toggle="modal" data-target="#changeBookingModal">Test</a>
          </div>
        </div>
                  </div>
                  <div class="float-right-actions">
                    <% if(booking.itinerary){ %>
                        <a class="btn btn-primary btn-sm" role="button" href="<%= booking.itinerary %>" target="_blank">
                          <span class="fa fa-file"></span> View Itinerary
                        </a>
    <% } else { %>

  <% } %>

                  </div>
                </div>
            </div>
          </div>



<!-- Modal -->
<div class="modal fade" id="newTransfer" tabindex="-1" role="dialog" aria-labelledby="newBooking" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="exampleModalLabel">Add new Transfer</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
  <form action="/bookings/new-transfer" method="post">
  <div class="form-group">
    <label for="recipient-name" class="col-form-label">Type:</label>
    <select class="form-control custom-select payment-status" name="type">
    <option value="Arrival Transfer">Arrival Transfer</option>
    <option value="Departure Transfer">Departure Transfer</option>
    </select>
  </div>
<div class="form-group">
    <label for="recipient-name" class="col-form-label">Date:</label>
    <input type="text" class="form-control datePicker" autocomplete="off" name="date">
</div>
<hr>
<p><strong>Flight Information</strong></p>
<div class="form-group">
    <label for="recipient-name" class="col-form-label">Flight Number:</label>
    <input type="text" class="form-control" name="flightnumber">
</div>
<div class="form-group">
    <label for="recipient-name" class="col-form-label">Flight Time:</label>
    <input type="time" class="form-control" name="flighttime">
</div>
<hr>
<p><strong>Pick-up Information</strong></p>
<div class="form-group">
<label for="recipient-name" class="col-form-label">Time</label>
<input type="time" class="form-control" name="pickuptime">
</div>
<div class="form-group">
<label for="recipient-name" class="col-form-label">Location</label>
<input type="text" class="form-control" name="location">
</div>
<div class="form-group">
<label for="recipient-name" class="col-form-label">Number of People</label>
<input type="number" class="form-control" name="people" value="<%= travellers.length %>">
</div>
<hr>
<div class="form-group">
<label for="exampleFormControlTextarea1">Extra Information</label>
<textarea class="form-control" id="exampleFormControlTextarea1" name="extraInfo" rows="3"></textarea>
</div>
</div>
<div class="modal-footer">
<input type="hidden" name="bookingid" value="<%= booking.id %>">
<input type="hidden" name="bookingname" value="<%= booking.firstname %> <%= booking.lastname %>">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
<button type="submit" class="btn btn-primary">Create</button>
</form>
</div>
</div>
</div>
</div>


<div class="modal fade" id="changeStatus" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Change Status</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body main-statusChange">

        <form method="post" action="">
          <!-- <input type="hidden" id="messageDelete" name="messageID" value=""> -->

      </div>
      <div class="modal-action">

      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>



          <!-- Modal -->
<div class="modal fade" id="newPackage" tabindex="-1" role="dialog" aria-labelledby="newBooking" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add new Package</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
              <label for="recipient-name" class="col-form-label">Arrival date:</label>
              <input type="text" class="form-control datePicker" name="date" autocomplete="off">
        </div>
        <div class="form-group">
              <label for="recipient-name" class="col-form-label">Departure date:</label>
              <input type="text" class="form-control datePicker" autocomplete="off" name="date">
        </div>
        <div class="form-group">
              <label for="recipient-name" class="col-form-label">Arrival flight:</label>
              <input type="text" class="form-control" name="date">
        </div>
        <div class="form-group">
              <label for="recipient-name" class="col-form-label">Departure flight:</label>
              <input type="text" class="form-control" name="date">
        </div>
        <div class="form-group">
          <label for="recipient-name" class="col-form-label">Number of travellers</label>
          <input type="number" class="form-control" name="date">
          </div>
      </div>
      <div class="modal-footer">
        <input type="hidden" name="bookingname" value="<%= booking.firstname %> <%= booking.lastname %>">
        <input type="hidden" name="bookingid" value="<%= booking.id %>">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Create</button>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="editTraveller" tabindex="-1" role="dialog" aria-labelledby="newTraveller" aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="exampleModalLabel">Edit Travellers</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
  <p><strong>Travellers - <%= travellers.length %> PAX:</strong></p>
  <% travellers.forEach(function(traveller) { %>
    <div class="row">
        <div class="traveller-list" id="<%= traveller.id %>">
      <div class="col-md-5 no-padding left-padding">
        <div class="form-group">
        <label for="recipient-name" class="col-form-label">Name:</label>
        <input type="text" class="form-control traveller-change <%= traveller.id %>" name="name" value="<%= traveller.name %>">
      </div>
      </div>
      <div class="col-md-2 no-padding">
          <label for="recipient-name" class="col-form-label">Age:</label>
          <input type="text" class="form-control traveller-change <%= traveller.id %>" name="age" value="<%= traveller.age %>">
      </div>
      <div class="col-md-2 no-padding">
          <label for="recipient-name" class="col-form-label">Height:</label>
          <input type="text" class="form-control traveller-change <%= traveller.id %>" name="height" value="<%= traveller.height %>">
      </div>
      <div class="col-md-2 no-padding">
          <label for="recipient-name" class="col-form-label">Weight:</label>
          <input type="text" class="form-control traveller-change <%= traveller.id %>" name="weight" value="<%= traveller.weight %>">
      </div>
      <div class="col-md-1 no-padding right-padding">
          <label for="recipient-name" class="col-form-label"></label>
        <input class="btn btn-danger" type="submit" value="x">
      </div>
      <input type="hidden" name="bookingid" value="<%= booking.id %>">
    </div>
    </div>
  <% }); %>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>


<!-- Modal -->
<div class="modal fade" id="newTraveller" tabindex="-1" role="dialog" aria-labelledby="newTraveller" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="exampleModalLabel">Add new Traveller</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<form action="/bookings/traveller" method="post" encType="multipart/form-data">
<div class="form-group">
    <label for="recipient-name" class="col-form-label">Name:</label>
    <input type="text" class="form-control" name="name">
  </div>
  <div class="form-group">
    <label for="recipient-name" class="col-form-label">Age:</label>
    <input type="text" class="form-control" name="age">
</div>
<div class="form-group">
  <label for="recipient-name" class="col-form-label">Height:</label>
  <input type="text" class="form-control" name="height">
</div>
<div class="form-group">
  <label for="recipient-name" class="col-form-label">Weight:</label>
  <input type="text" class="form-control" name="weight">
</div>
</div>
<div class="modal-footer">
<input type="hidden" name="bookingid" value="<%= booking.id %>">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
<button type="submit" class="btn btn-primary">Save</button>
</form>
</div>
</div>
</div>
</div>




          <!-- Modal -->
<div class="modal fade" id="newPayment" tabindex="-1" role="dialog" aria-labelledby="newPayment" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add new Payment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="/bookings/payment" method="post" encType="multipart/form-data">
        <div class="form-group">
              <label for="recipient-name" class="col-form-label">Date:</label>
              <input type="text" class="form-control datePicker" name="date">
            </div>
            <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Amount:</label>
                  <input type="text" class="form-control format-isk" name="amount">
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Payment Status:</label>
            <select class="form-control custom-select payment-status" name="status">
                              <option value="Paid">Paid</option>
                              <option value="Unpaid">Unpaid</option>
                            </select>
          </div>
      </div>
      <div class="modal-footer">
        <input type="hidden" name="bookingname" value="<%= booking.firstname %> <%= booking.lastname %>">
        <input type="hidden" name="bookingid" value="<%= booking.id %>">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </form>
      </div>
    </div>
  </div>
</div>

          <section class="forms">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-lg-4">

                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Client details</h3>
                    </div>
                    <div class="card-body client">
                      <div class="media">
                        <div class="media-body">

                          <div class="row">
                            <div class="col-lg-6 col-md-12">
                              <h4><%= booking.firstname %> <%= booking.lastname %></h4>
                              <i class="fa fa-phone"></i> <%= booking.phonenumber %><br>
                              <i class="fa fa-envelope"></i> <%= booking.email %><br>

                            </div><div class="col-lg-6 col-md-12">
                            <p class="text-muted mb-0">Address: <%= booking.address %></p>
                            <p class="text-muted mb-0">Zip Code: <%= booking.zip %></p>
                            <p class="text-muted mb-0">City: <%= booking.city %></p>
                            <p class="text-muted mb-0">Country: <%= booking.country %></p>
                            </div>
                          </div>

                          <hr>
                          <div class="row">
                            <div class="col-md-12">
                              <p><strong>Travellers - <%= travellers.length %> PAX:</strong></p>
                              <% travellers.forEach(function(traveller) { %>
                                <div class="travel-detail-one">
                                  <div class="row">
                                    <div class="col-md-6">
                                      <% if (traveller.height) { %>
                                          <p><%= traveller.name %> <a class="extra-info" data-container="body" data-toggle="popover" data-placement="top" data-content="Height: <%= traveller.height %> - Weight: <%= traveller.weight %>"><i class="fa fa-info-circle"></i></a></p>
                                      <% } else { %>
                                        <p><%= traveller.name %></p>
                                      <% } %>
                                    </div>
                                    <div class="col-md-6">
                                      <p><%= traveller.age %></p>
                                    </div>
                                  </div>
                                </div>
                              </tr>
                              <% }); %>

                            </div>
                          </div>



                        </div>

                      </div>
                    </div>
                  </div>
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Emails</h3>
                    </div>
                    <div class="card-body client">
                      <div class="media">
                        <div class="media-body">







                        </div>

                      </div>
                    </div>
                  </div>

                  <div class="recent-updates card">
                      <div class="card-header">
                        <h3 class="h4">Payments</h3>
                        <div class="card-close">
                        <% if(outstanding === 0){ %>
                          <span class="badge badge-success">PAID IN FULL</span>

                          <% } else{ %>

                            <span class="badge badge-danger">Not Paid in Full</span>

                          <% } %>
                          </div>
                      </div>
                      <div class="card-body no-padding">

                        <% payments.forEach(function(payment) { %>

                          <div class="item d-flex justify-content-between">
                            <div class="info d-flex">
                              <div class="title">
                                <h5><%= moment(payment.date).format('LL') %></h5>
                                <p><strong><%= numeral(payment.amount).format('0,0'); %> ISK</strong>
                                <% if (payment.status === "Paid") { %>

                                  <span class="badge badge-success"><%= payment.status %></span>

                                  </p>

                                <% } else { %>

                              <span class="badge badge-danger"><%= payment.status %></span>

                              </p>


                                <% } %>

                              </div>
                            </div>
                            <div class="payment-action">
                              <button class="btn btn-outline-dark btn-sm no-outline" type="button" data-toggle="modal" data-target="#editPayment" data-date="<%= moment(payment.date).format('LL') %>" data-status="<%= payment.status %>" data-id="<%= payment.id %>" data-amount="<%= numeral(payment.amount).format('0,0'); %>"><span class="fa fa-pencil"></span></button>
                            </div>
                          </div>
                        <!-- Item-->

                        <div class="modal fade" id="editPayment" tabindex="-1" role="dialog" aria-labelledby="editPayment" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Payment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post" action="" class="paymentToUpdate" encType="multipart/form-data">
        <input type="hidden" name="booking" value="<%= booking.id %>">
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Payment Status:</label>
            <select class="form-control custom-select payment-status" name="status">
                              <option value="Paid">Paid</option>
                              <option value="Unpaid">Unpaid</option>
                            </select>
          </div>
        <h2 class="modal-amount"></h2>
      </div>
      <div class="modal-footer">
        <button type="button" data-toggle="modal" data-target="#removePayment" data-paymentid="" aria-haspopup="true" aria-expanded="false" class="btn btn-danger">Delete</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="removePayment" tabindex="-1" role="dialog" aria-labelledby="removePayment" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete Payment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Do you want to delete this payment?</p>
        <form method="post" action="" class="deletePayment">
          <input type="hidden" name="bookingID" value="<%= booking.id %>">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
      </div>
    </div>
  </div>
</div>



                        <% }); %>

                      </div>
                      <div class="card-footer payment-summary">
                        <div class="row">
                          <div class="col-md-4 col-xs-12">
                            <i class="material-icons flight-icon">money_off</i>
                            <p>Outstanding</p>
        <p><strong><%= numeral(outstanding).format('0,0') %> ISK</strong></p>
                          </div>
                          <div class="col-md-4 col-xs-12">
          <i class="material-icons flight-icon">check</i>
          <p>Paid</p>
          <p><strong><%= numeral(totalPaid).format('0,0') %> ISK</strong></p>
        </div>
        <div class="col-md-4 col-xs-12">
          <i class="material-icons flight-icon">attach_money</i>
          <p>Total</p>
          <p><strong><%= numeral(booking.finalprice).format('0,0') %> ISK</strong></p>
        </div>
                        </div>
                    </div>
                    </div>

                </div>

                  <!-- Inline Form-->
                  <div class="col-lg-8">

                      <% transfers.forEach(function(transfer) { %>
                          <div class="card-cold">
                            <% if (transfer.status == "Confirmed") { %>
                              <form class="card card-booking-item" style="border-color: #28a745;">
                              <% } else if (transfer.status == "Cancelled") { %>
                                <form class="card card-booking-item" style="border-color: #dc3545;">
                              <% } else { %>
                            <form class="card card-booking-item">
                              <% } %>
                            <div class="card-header">
                              <div class="row">
                                  <div class="col-md-6">
                                    <h3 class="card-title">
                                      <% if (transfer.type == "Arrival Transfer") { %>
                                              <i class="material-icons">flight_land</i>
                                        <% } else { %>

                                            <i class="material-icons">flight_takeoff</i>
                                          <% } %>
                                          <%= transfer.type %>
                                  </div>
                                  <div class="col-md-6">
                                    <% if (transfer.status == "Confirmed") { %>
                                      <span class="badge badge-success confirmed-tour-item" data-toggle="modal" data-target="#changeStatus" data-id="<%= transfer.id %>" data-type="<%= transfer.type %>" data-date="<%= moment(transfer.date).format('LL') %>" data-pickuptime="<%= transfer.pickuptime %>" data-pickupLocation="<%= transfer.location %>" data-people="<%= transfer.people %>" data-getStatus="<%= transfer.status %>"><%= transfer.status %></span>
                                      <% } else if (transfer.status == "Cancelled") { %>
                                      <span class="badge badge-danger confirmed-tour-item" data-toggle="modal" data-target="#changeStatus" data-id="<%= transfer.id %>" data-type="<%= transfer.type %>" data-date="<%= moment(transfer.date).format('LL') %>" data-pickuptime="<%= transfer.pickuptime %>" data-pickupLocation="<%= transfer.location %>" data-people="<%= transfer.people %>" data-getStatus="<%= transfer.status %>"><%= transfer.status %></span>
                                      <% } else { %>
                                      <span class="badge badge-warning confirmed-tour-item" data-toggle="modal" data-target="#changeStatus" data-id="<%= transfer.id %>" data-type="<%= transfer.type %>" data-date="<%= moment(transfer.date).format('LL') %>" data-pickuptime="<%= transfer.pickuptime %>" data-pickupLocation="<%= transfer.location %>" data-people="<%= transfer.people %>" data-getStatus="<%= transfer.status %>"><%= transfer.status %></span>
                                      <% } %>
                                  </div>
                              </div>
                            </div>

                        <div class="card-body" style="padding: 0px;">
                          <div class="item booking-item-details">
                            <div class="row">
                              <div class="col-md-4 booking-item-detail-col">
                                <div class="title">
                                  <h5><%= moment(transfer.date).format('LL') %></h5>
                                  <% if (transfer.extraInfo) { %>
                                      <p><%= transfer.people %> PAX <a class="extra-info" data-container="body" data-toggle="popover" data-placement="top" data-content="<%= transfer.extraInfo %>"><i class="fa fa-info-circle"></i> Extra Information</a></p>
                                    <% } else { %>
                                    <p><%= transfer.people %> PAX</p>
                                    <% } %>
                                </div>
                              </div>
                              <div class="col-md-6 booking-item-detail-col">
                                <div class="row">
                                  <div class="col-md-6">
                                    <p>Flight: <br><%= transfer.flightnumber %> at <%= transfer.flighttime %></p>
                                  </div>
                                  <div class="col-md-6">
                                    <p>Pick-up: <br><%= transfer.location %> at <%= transfer.pickuptime %></p>
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-2 float-right booking-item-detail-col">
                                <div class="row">
                                  <div class="col-12">
                                    <% if (transfer.status == "Confirmed"){ %>
                                      <p>Driver: </br> <%= transfer.driver %></p>

                                      <% } else { %>
                                        <p></p>

<% } %>
                                  </div>
                                </div>
                              </div>
                          </div>
                        </div>

                      </form>
                      </div>


                      <% }); %>

<!--
                    <div class="card-cold">
                      <form class="card card-booking-item">
                      <div class="card-header">
                        <div class="row">
                            <div class="col-md-6">
                              <h3 class="card-title"><a href="">#DI1547656597</a></h3>
                            </div>
                            <div class="col-md-6">
                                                      <span class="badge badge-secondary confirmed-tour-item">Not Confirmed</span>
                            </div>
                        </div>
                      </div>
                      <div class="card-body" style="padding: 0px;">
                        <div class="item booking-item-details">
                          <div class="row">
                            <div class="col-md-4 booking-item-detail-col">
                              <div class="title">
                                <h5>20 July, 2019 <span class="badge badge-secondary">Day Tour</span></h5>
                                <p>1 days / 8 Pax</p>
                              </div>
                            </div>
                            <div class="col-md-6 booking-item-detail-col">
                              <div class="row">
                                <div class="col-md-6">
                                  <p>Tour: <br>The Golden Circle & Langjökull</p>
                                </div>
                                <div class="col-md-6">
                                  <p>Pick-up: <br>Hotel Borg at 10:00 AM</p>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-2 float-right booking-item-detail-col">
                              <p class="item-booking-price">2.800.000 ISK</p>
                              <span class="badge badge-secondary confirmed-tour-item">Not Paid</span>
                            </div>
                        </div>
                      </div>

                    </form>
                    </div>
                      </div> -->
                    </div>


                </div>

            </section>

            <div class="modal" id="changeBookingModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-full" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Booking - <%= booking.firstname %> <%= booking.lastname %></h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body" id="result">
                          <!-- Modal -->
<div class="modal fade" id="dayDetails" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
                          <div class="row justify-content-center h-100">
                              <div class="col-md-12 col-xl-5 col-sm-12 no-padding cart-side" style="height: 95vh">
                                <table class="table table-striped table-hover">
                            <thead>
                              <tr>
                                <th>Day</th>
                                <th></th>
                                <th>Date</th>
                                <th>Accommodation</th>
                                <th></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <th scope="row">1</th>
                                <td>Arrival</td>
                                <td>23 Apri, 2019</td>
                                <td><button type="button" class="btn btn-link"  data-toggle="modal" data-target="#dayDetails"><span class="fa fa-eye"></span></button></td>
                              </tr>
                              <tr>
                                <th scope="row">2</th>
                                <td>Jacob</td>
                                <td>Thornton</td>
                                <td>@fat</td>
                              </tr>
                              <tr>
                                <th scope="row">3</th>
                                <td>Larry</td>
                                <td>the Bird</td>
                                <td>@twitter                            </td>
                              </tr>
                            </tbody>
                          </table>
                              </div>
                              <div class="col-md-12 col-xl-7 col-sm-12 no-padding h-100" style="height: 95vh">
                                <ul class="nav nav-tabs nav-justified serviceTabs">
                          <li class="nav-item">
                          <a class="nav-link active" data-toggle="tab" href="#home">Accommodation</a>
                          </li>
                          <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#menu1">Activities</a>
                          </li>
                          <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#menu2">Driving Guidance</a>
                          </li>
                          <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#menu3">Custom</a>
                          </li>
                          </ul>

                          <!-- Tab panes -->
                          <div class="tab-content">
                          <div class="tab-pane active serviceHolder" id="home">
                          <div class="service-search">
                          <form id="getRooms">
                          <div class="row">
                            <div class="col-md-4">
                            <select class="js-example-placeholder-single hotelselect" id="hotels"><option disabled="" selected="">Select Hotel</option></select>
                            </div>
                            <div class="col-md-4">
                                                        <input type="text" class="input-sm form-control datepicker datepickerHotel" id="dpd1" autocomplete="false" name="startDate" placeholder="Check-in" required/>
                            </div>
                            <div class="col-md-4">

                            </div>
                          </div>
                          </form>

                          </div>
                          <div class="service-items-holder">
                          <ul class="list-group" id="roomList"></ul>
                          </div>


                          </div>
                          <div class="tab-pane container fade serviceHolder" id="menu1">2...</div>
                          <div class="tab-pane container fade serviceHolder" id="menu2">3...</div>
                          <div class="tab-pane  fade serviceHolder" id="menu3">
                            <div class="container">
                          <form class="addCustom">
                            <p>Add custom item</p>
                          <div class="form-group">
                            <input type="email" placeholder="Item" class="form-control">
                          </div>
                          <div class="form-group">
                          <select class="form-control custom-select">
                            <option value="11">0%</option>
                            <option value="11" selected>11%</option>
                            <option value="24">24%</option>
                          </select>
                          </div>
                          <div class="form-group">
                          <label for="inlineFormInput" class="sr-only">Commission</label>
                          <select class="form-control custom-select">
                            <option value="5">5%</option>
                            <option value="10">10%</option>
                            <option value="15" selected>15%</option>
                            <option value="20">20%</option>
                            <option value="25">25%</option>
                            <option value="30">30%</option>
                          </select>
                          </div>
                          <div class="form-group">
                            <input type="password" placeholder="Total" class="form-control">
                          </div>
                          <div class="form-group">
                            <button type="submit" name="button" class="btn btn-success customButto">Add <span class="fa fa-plus"></span></button>
                          </div>
                        </form>
                            </div>
                          </div>
                          </div>

                              </div>
                          </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Edit contact details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post" action="/bookings/update/<%= booking.id %>" enctype="multipart/form-data">
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">First Name:</label>
            <input type="text" class="form-control" name="firstname" value="<%= booking.firstname %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Last Name:</label>
            <input type="text" class="form-control" name="lastname" value="<%= booking.lastname %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Phone:</label>
            <input type="text" class="form-control" name="phonenumber" value="<%= booking.phonenumber %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Email:</label>
            <input type="email" class="form-control" name="email" value="<%= booking.email %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Address:</label>
            <input type="text" class="form-control" name="address" value="<%= booking.address %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">ZIP:</label>
            <input type="text" class="form-control" name="zip" value="<%= booking.zip %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">City:</label>
            <input type="text" class="form-control" name="city" value="<%= booking.city %>" required>
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Country:</label>
            <select id="selectedCountry" class="form-control custom-select" name="country" required>
                  <option value="Afghanistan">Afghanistan</option>
                   <option value="Albania">Albania</option>
                   <option value="Algeria">Algeria</option>
                   <option value="American Samoa">American Samoa</option>
                   <option value="Andorra">Andorra</option>
                   <option value="Angola">Angola</option>
                   <option value="Anguilla">Anguilla</option>
                   <option value="Antartica">Antarctica</option>
                   <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                   <option value="Argentina">Argentina</option>
                   <option value="Armenia">Armenia</option>
                   <option value="Aruba">Aruba</option>
                   <option value="Australia">Australia</option>
                   <option value="Austria">Austria</option>
                   <option value="Azerbaijan">Azerbaijan</option>
                   <option value="Bahamas">Bahamas</option>
                   <option value="Bahrain">Bahrain</option>
                   <option value="Bangladesh">Bangladesh</option>
                   <option value="Barbados">Barbados</option>
                   <option value="Belarus">Belarus</option>
                   <option value="Belgium">Belgium</option>
                   <option value="Belize">Belize</option>
                   <option value="Benin">Benin</option>
                   <option value="Bermuda">Bermuda</option>
                   <option value="Bhutan">Bhutan</option>
                   <option value="Bolivia">Bolivia</option>
                   <option value="Bosnia and Herzegowina">Bosnia and Herzegowina</option>
                   <option value="Botswana">Botswana</option>
                   <option value="Bouvet Island">Bouvet Island</option>
                   <option value="Brazil">Brazil</option>
                   <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
                   <option value="Brunei Darussalam">Brunei Darussalam</option>
                   <option value="Bulgaria">Bulgaria</option>
                   <option value="Burkina Faso">Burkina Faso</option>
                   <option value="Burundi">Burundi</option>
                   <option value="Cambodia">Cambodia</option>
                   <option value="Cameroon">Cameroon</option>
                   <option value="Canada">Canada</option>
                   <option value="Cape Verde">Cape Verde</option>
                   <option value="Cayman Islands">Cayman Islands</option>
                   <option value="Central African Republic">Central African Republic</option>
                   <option value="Chad">Chad</option>
                   <option value="Chile">Chile</option>
                   <option value="China">China</option>
                   <option value="Christmas Island">Christmas Island</option>
                   <option value="Cocos Islands">Cocos (Keeling) Islands</option>
                   <option value="Colombia">Colombia</option>
                   <option value="Comoros">Comoros</option>
                   <option value="Congo">Congo</option>
                   <option value="Congo">Congo, the Democratic Republic of the</option>
                   <option value="Cook Islands">Cook Islands</option>
                   <option value="Costa Rica">Costa Rica</option>
                   <option value="Cota D'Ivoire">Cote d'Ivoire</option>
                   <option value="Croatia">Croatia (Hrvatska)</option>
                   <option value="Cuba">Cuba</option>
                   <option value="Cyprus">Cyprus</option>
                   <option value="Czech Republic">Czech Republic</option>
                   <option value="Denmark">Denmark</option>
                   <option value="Djibouti">Djibouti</option>
                   <option value="Dominica">Dominica</option>
                   <option value="Dominican Republic">Dominican Republic</option>
                   <option value="East Timor">East Timor</option>
                   <option value="Ecuador">Ecuador</option>
                   <option value="Egypt">Egypt</option>
                   <option value="El Salvador">El Salvador</option>
                   <option value="Equatorial Guinea">Equatorial Guinea</option>
                   <option value="Eritrea">Eritrea</option>
                   <option value="Estonia">Estonia</option>
                   <option value="Ethiopia">Ethiopia</option>
                   <option value="Falkland Islands">Falkland Islands (Malvinas)</option>
                   <option value="Faroe Islands">Faroe Islands</option>
                   <option value="Fiji">Fiji</option>
                   <option value="Finland">Finland</option>
                   <option value="France">France</option>
                   <option value="France Metropolitan">France, Metropolitan</option>
                   <option value="French Guiana">French Guiana</option>
                   <option value="French Polynesia">French Polynesia</option>
                   <option value="French Southern Territories">French Southern Territories</option>
                   <option value="Gabon">Gabon</option>
                   <option value="Gambia">Gambia</option>
                   <option value="Georgia">Georgia</option>
                   <option value="Germany">Germany</option>
                   <option value="Ghana">Ghana</option>
                   <option value="Gibraltar">Gibraltar</option>
                   <option value="Greece">Greece</option>
                   <option value="Greenland">Greenland</option>
                   <option value="Grenada">Grenada</option>
                   <option value="Guadeloupe">Guadeloupe</option>
                   <option value="Guam">Guam</option>
                   <option value="Guatemala">Guatemala</option>
                   <option value="Guinea">Guinea</option>
                   <option value="Guinea-Bissau">Guinea-Bissau</option>
                   <option value="Guyana">Guyana</option>
                   <option value="Haiti">Haiti</option>
                   <option value="Heard and McDonald Islands">Heard and Mc Donald Islands</option>
                   <option value="Holy See">Holy See (Vatican City State)</option>
                   <option value="Honduras">Honduras</option>
                   <option value="Hong Kong">Hong Kong</option>
                   <option value="Hungary">Hungary</option>
                   <option value="Iceland">Iceland</option>
                   <option value="India">India</option>
                   <option value="Indonesia">Indonesia</option>
                   <option value="Iran">Iran (Islamic Republic of)</option>
                   <option value="Iraq">Iraq</option>
                   <option value="Ireland">Ireland</option>
                   <option value="Israel">Israel</option>
                   <option value="Italy">Italy</option>
                   <option value="Jamaica">Jamaica</option>
                   <option value="Japan">Japan</option>
                   <option value="Jordan">Jordan</option>
                   <option value="Kazakhstan">Kazakhstan</option>
                   <option value="Kenya">Kenya</option>
                   <option value="Kiribati">Kiribati</option>
                   <option value="Democratic People's Republic of Korea">Korea, Democratic People's Republic of</option>
                   <option value="Korea">Korea, Republic of</option>
                   <option value="Kuwait">Kuwait</option>
                   <option value="Kyrgyzstan">Kyrgyzstan</option>
                   <option value="Lao">Lao People's Democratic Republic</option>
                   <option value="Latvia">Latvia</option>
                   <option value="Lebanon" selected="">Lebanon</option>
                   <option value="Lesotho">Lesotho</option>
                   <option value="Liberia">Liberia</option>
                   <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
                   <option value="Liechtenstein">Liechtenstein</option>
                   <option value="Lithuania">Lithuania</option>
                   <option value="Luxembourg">Luxembourg</option>
                   <option value="Macau">Macau</option>
                   <option value="Macedonia">Macedonia, The Former Yugoslav Republic of</option>
                   <option value="Madagascar">Madagascar</option>
                   <option value="Malawi">Malawi</option>
                   <option value="Malaysia">Malaysia</option>
                   <option value="Maldives">Maldives</option>
                   <option value="Mali">Mali</option>
                   <option value="Malta">Malta</option>
                   <option value="Marshall Islands">Marshall Islands</option>
                   <option value="Martinique">Martinique</option>
                   <option value="Mauritania">Mauritania</option>
                   <option value="Mauritius">Mauritius</option>
                   <option value="Mayotte">Mayotte</option>
                   <option value="Mexico">Mexico</option>
                   <option value="Micronesia">Micronesia, Federated States of</option>
                   <option value="Moldova">Moldova, Republic of</option>
                   <option value="Monaco">Monaco</option>
                   <option value="Mongolia">Mongolia</option>
                   <option value="Montserrat">Montserrat</option>
                   <option value="Morocco">Morocco</option>
                   <option value="Mozambique">Mozambique</option>
                   <option value="Myanmar">Myanmar</option>
                   <option value="Namibia">Namibia</option>
                   <option value="Nauru">Nauru</option>
                   <option value="Nepal">Nepal</option>
                   <option value="Netherlands">Netherlands</option>
                   <option value="Netherlands Antilles">Netherlands Antilles</option>
                   <option value="New Caledonia">New Caledonia</option>
                   <option value="New Zealand">New Zealand</option>
                   <option value="Nicaragua">Nicaragua</option>
                   <option value="Niger">Niger</option>
                   <option value="Nigeria">Nigeria</option>
                   <option value="Niue">Niue</option>
                   <option value="Norfolk Island">Norfolk Island</option>
                   <option value="Northern Mariana Islands">Northern Mariana Islands</option>
                   <option value="Norway">Norway</option>
                   <option value="Oman">Oman</option>
                   <option value="Pakistan">Pakistan</option>
                   <option value="Palau">Palau</option>
                   <option value="Panama">Panama</option>
                   <option value="Papua New Guinea">Papua New Guinea</option>
                   <option value="Paraguay">Paraguay</option>
                   <option value="Peru">Peru</option>
                   <option value="Philippines">Philippines</option>
                   <option value="Pitcairn">Pitcairn</option>
                   <option value="Poland">Poland</option>
                   <option value="Portugal">Portugal</option>
                   <option value="Puerto Rico">Puerto Rico</option>
                   <option value="Qatar">Qatar</option>
                   <option value="Reunion">Reunion</option>
                   <option value="Romania">Romania</option>
                   <option value="Russia">Russian Federation</option>
                   <option value="Rwanda">Rwanda</option>
                   <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                   <option value="Saint LUCIA">Saint LUCIA</option>
                   <option value="Saint Vincent">Saint Vincent and the Grenadines</option>
                   <option value="Samoa">Samoa</option>
                   <option value="San Marino">San Marino</option>
                   <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                   <option value="Saudi Arabia">Saudi Arabia</option>
                   <option value="Senegal">Senegal</option>
                   <option value="Seychelles">Seychelles</option>
                   <option value="Sierra">Sierra Leone</option>
                   <option value="Singapore">Singapore</option>
                   <option value="Slovakia">Slovakia (Slovak Republic)</option>
                   <option value="Slovenia">Slovenia</option>
                   <option value="Solomon Islands">Solomon Islands</option>
                   <option value="Somalia">Somalia</option>
                   <option value="South Africa">South Africa</option>
                   <option value="South Georgia">South Georgia and the South Sandwich Islands</option>
                   <option value="Span">Spain</option>
                   <option value="SriLanka">Sri Lanka</option>
                   <option value="St. Helena">St. Helena</option>
                   <option value="St. Pierre and Miguelon">St. Pierre and Miquelon</option>
                   <option value="Sudan">Sudan</option>
                   <option value="Suriname">Suriname</option>
                   <option value="Svalbard">Svalbard and Jan Mayen Islands</option>
                   <option value="Swaziland">Swaziland</option>
                   <option value="Sweden">Sweden</option>
                   <option value="Switzerland">Switzerland</option>
                   <option value="Syria">Syrian Arab Republic</option>
                   <option value="Taiwan">Taiwan, Province of China</option>
                   <option value="Tajikistan">Tajikistan</option>
                   <option value="Tanzania">Tanzania, United Republic of</option>
                   <option value="Thailand">Thailand</option>
                   <option value="Togo">Togo</option>
                   <option value="Tokelau">Tokelau</option>
                   <option value="Tonga">Tonga</option>
                   <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                   <option value="Tunisia">Tunisia</option>
                   <option value="Turkey">Turkey</option>
                   <option value="Turkmenistan">Turkmenistan</option>
                   <option value="Turks and Caicos">Turks and Caicos Islands</option>
                   <option value="Tuvalu">Tuvalu</option>
                   <option value="Uganda">Uganda</option>
                   <option value="Ukraine">Ukraine</option>
                   <option value="United Arab Emirates">United Arab Emirates</option>
                   <option value="United Kingdom">United Kingdom</option>
                   <option value="United States" selected="">United States</option>
                   <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option>
                   <option value="Uruguay">Uruguay</option>
                   <option value="Uzbekistan">Uzbekistan</option>
                   <option value="Vanuatu">Vanuatu</option>
                   <option value="Venezuela">Venezuela</option>
                   <option value="Vietnam">Viet Nam</option>
                   <option value="Virgin Islands (British)">Virgin Islands (British)</option>
                   <option value="Virgin Islands (U.S)">Virgin Islands (U.S.)</option>
                   <option value="Wallis and Futana Islands">Wallis and Futuna Islands</option>
                   <option value="Western Sahara">Western Sahara</option>
                   <option value="Yemen">Yemen</option>
                   <option value="Yugoslavia">Yugoslavia</option>
                   <option value="Zambia">Zambia</option>
                   <option value="Zimbabwe">Zimbabwe</option>
                          </select>
          </div>
          <div class="form-group">
              <label>Final Itinerary</label>
              <input type="file" class="form-control" name="itinerary"/>
          </div>
          <% if (travellers.length > 0 ||  booking.itinerary || booking.status != "Confirmed") { %>
            <div class="form-group form-check">
              <input type="checkbox" class="form-check-input" name="bookingconfirmed" id="bookingconfirmed">
              <label class="form-check-label" for="exampleCheck1">Booking is fully confirmed.</label>
      </div>
<% } else { %>
    <p>Hey terra!</p>
<% } %>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
        </form>
      </div>
    </div>
  </div>
</div>


            <% drivers.forEach(function(driver) { %>

            <input type="hidden" class="driver" value="<%= driver.name %>" data-id="<%= driver._id %>">


            <% }); %>



            <input type="hidden" name="" id="BookingEmail" value="<%= booking.email %>">

            <% hotels.forEach(function(hotel) { %>

            <input type="hidden" class="hotel" value="<%= hotel.name %>" data-id="<%= hotel.id %>">


            <% }); %>

            <input type="hidden" name="" id="bookingCountry" value="<%= booking.country %>">

<%- include ../../temp/footer.ejs %>

<script type='text/javascript'>


$( "input.form-control.traveller-change" ).keyup(function() {

  var travellerID = $(this).closest('.traveller-list').attr('id');
  var Selectname = $("input.form-control.traveller-change."+ travellerID).attr('name');
  var name = $(Selectname).val();
  // var name = $(traveller-list).att('name');
  // var age = $(traveller-list).att('age');
  // var weight = $(traveller-list).att('weight');
  // var height = $(traveller-list).att('height');

  console.log(name)


});








var BookingEmail = $("#BookingEmail").val();


$.ajax({
  url: "https://api.postmarkapp.com/messages/outbound?count=500&offset=0&recipient=sigurdur%40deluxeiceland.is",
  headers: {"Accept": "application/json", "X-Postmark-Server-Token": "06e91cdb-7bf5-4b2d-9b96-fd201221dbdd"}
}).done(function(data) {
  console.log(data);
});



var BookingCountry = $("#bookingCountry").val();

$('select#selectedCountry').val(BookingCountry);

$('#removePayment').on('show.bs.modal', function (event) {

var button = $(event.relatedTarget) // Button that triggered the modal
var id = button.data('paymentid');


var modal = $(this)
$('.deletePayment').attr('action', '/bookings/remove/payments/'+ id);

});


$('.datePicker').datepicker({
    orientation: "bottom auto",
    todayHighlight: true,
    autoclose: true
});

$('input[type="text"].format-isk').maskNumber({
   integer: true,
   decimal: '',
   thousands: '.'

 })



$('#editPayment').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget); // Button that triggered the modal
  var amount = button.data('amount'); // Extract info from data-* attributes
  var status = button.data('status');
  var date = button.data('date');
  var id = button.data('id');
  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
  var modal = $(this)
  modal.find('.modal-title').text('Payment: ' + date)
  modal.find('h2.modal-amount').html('<i class="material-icons">attach_money</i> ' + amount + ' ISK')
  modal.find('select.form-control.custom-select.payment-status').val(status);
  modal.find('.btn-danger').attr('data-paymentid', id);
  $('.paymentToUpdate').attr('action', '/bookings/payment/update-status/'+ id);
});

numeral.register('locale', 'fr', {
    delimiters: {
        thousands: '.',
        decimal: ','
    },
    abbreviations: {
        thousand: 'k',
        million: 'm',
        billion: 'b',
        trillion: 't'
    },
    ordinal : function (number) {
        return number === 1 ? 'er' : 'ème';
    },
    currency: {
        symbol: '€'
    }
});

// switch between locales
numeral.locale('fr');

function removeCartFunction(btn){

  var itemID = btn.getAttribute('data');
  var currentval = $("tr#"+ itemID).find("input.form-control.count").val();


  if(currentval == 1) {

    $( "#shoppingCart" ).find("tr#"+ itemID).remove();

  } else {

    var newVal = parseInt(currentval) - 1;
    $("tr#"+ itemID).find("input.form-control.count").val(newVal);

  }

}

function updateCartFunction(item){

  var currentval = $("tr#"+ item).find("input.form-control.count").val();

  var newVal = parseInt(currentval) + 1;
  $("tr#"+ item).find("input.form-control.count").val(newVal);

}

function addCartFunction(btn){

var itemID = btn.getAttribute('data');
var roomType = btn.getAttribute('type');
var roomSleeps = btn.getAttribute('sleeps');

checkItem = $("#shoppingCart").find("tr#"+ itemID)


if (checkItem.length > 0) {

  updateCartFunction(itemID);


} else {



  $("#shoppingCart").append('<tr id="'+ itemID +'"><th scope="row">'+ roomType +'</th><td><select class="form-control custom-select" name="source"><option value="0">0%</option><option value="11">11%</option><option value="24">24%</option></select></td><td><select class="form-control custom-select" name="source"><option value="0">0%</option><option value="5">5%</option><option value="10">10%</option><option value="15">15%</option><option value="20">20%</option><option value="25">25%</option><option value="30">30%</option></select></td><td><input type="number" value="1" placeholder="QTY" class="form-control count"></td><td>87.000 ISK</td><td><button data="'+  itemID+'" onclick="removeCartFunction(this);" class="btn btn-danger"> - </button></td></tr>')

}





}


function changeCommission(item){

var itemID = item.getAttribute('data');
var itemNet = item.getAttribute('net');


var itemCommission =  $(item).find(":selected").val();
var newPrice = itemNet * itemCommission;
var formatedPrice = numeral(newPrice).format('0,0');
$("li#"+ itemID).find("p.room-price").text(formatedPrice + " ISK");

}




function getRoomList(start, end) {

  $("#roomList").html("");
  Ladda.bind( 'button[type=submit]', { timeout: 2000 } );


  var start = start.format('YYYY-MM-DD');
  var end = end.format('YYYY-MM-DD');

  var s = moment(start);
  var e = moment(end);
  var tripDuration = e.diff(s, 'days');
  tripDuration += 1;
  tripNights = tripDuration - 1;

  $("#tripNights").text("Total Price for "+ tripNights + " nights");
  var selectedSupplierID = $( "#hotels option:selected" ).val();

  $.get( "/bookings/get-rooms/"+ selectedSupplierID, function( data ) {
    var selectedSupplierID = $( "#hotels option:selected" ).val();


    console.log("Lenght "+ data.length)
    console.log(selectedSupplierID);

    var startDate = start;
    var endDate = end;



    calculatePrice(0, startDate, endDate);

    function calculatePrice(i, startDate, endDate) {
      if(i < data.length) {


        $.post( "/itineraries/calculate-room-price/"+ selectedSupplierID +"/"+ data[i]._id, { startDate: startDate, endDate: endDate }).done(function( calData ) {
          var salePrice = calData.totalCal * 1.15;

          console.log("Nights "+ tripNights)
          $('#roomList').append($('<li class="list-group-item per-room"  id='+  data[i]._id +'><input type="hidden" class="itemId" value='+  data[i]._id +'><input type="hidden" name="roomType"><div class="row"><div class="col-md-3"><p><strong>'+  data[i].type + '</strong></p><p class="vat-text">Max: '+ data[i].sleeps +' Person</p></div><div class="col-md-1"><label class="form-control-label">Commission</label><select net='+ calData.totalCal +' data='+  data[i]._id +' onchange="changeCommission(this);" class="form-control custom-select"><option value="1">0%</option><option value="1.05">5%</option><option value="1.1">10%</option><option value="1.15" selected="">15%</option><option value="1.20">20%</option><option value="1.25">25%</option><option value="1.30">30%</option></select></div><div class="col-md-4 text-center"><p class="room-price">'+ numeral(salePrice).format('0,0') +' ISK</p><p class="vat-text" id="tripNights">Total for '+ tripNights +' Nights</p></div><div class="col-md-3"><button data='+  data[i]._id +' type="'+  data[i].type +'" sleeps="'+ data[i].sleeps +'" onclick="addCartFunction(this);" class="btn btn-success add-item"> + </button><p class="vat-text">11% VAT included in prices</p><p class="vat-text">Breakfast not included</p></div></div></li>'


          ));

        });



        calculatePrice(i + 1, startDate, endDate);

      } else {
        console.log("Done");
      }
    }


  });










}









    $( ".hotel" ).each(function() {
      var hotelName = $(this).val();
      var hotelID = $(this).attr("data-id");
      $('select#hotels').append($('<option>', {
          value: hotelID,
          text: hotelName
      }));
    });




    $('input.datepicker').daterangepicker({
    "autoApply": true,
    "startDate": "11/14/2018",
    "endDate": "11/15/2018",
    "opens": "left"
}, function(start, end, label) {

  getRoomList(start, end);

});

$(".js-example-placeholder-single").select2({
    placeholder: "Select a state",
    allowClear: true
});




$('#changeStatus').on('show.bs.modal', function (event) {
  var button = $(event.relatedTarget) // Button that triggered the modal
  var id = button.data('id')
  var type = button.data('type')
  var date = button.data('date')
  var pickuptime = button.data('pickuptime')
  var pickupLocation = button.data('pickuplocation')
  var people = button.data('people')
  var getStatus = button.data('getstatus')
  var modal = $(this)
  modal.find('.modal-title').html('<p>Change status for ' + type +'</p>')
  modal.find('.modal-body.main-statusChange').html('<p>Date: '+ date +' at '+ pickuptime +'</p><p>Pick-up: '+ pickupLocation +' for '+ people +' PAX')
  console.log(getStatus)
  if (getStatus === "Not Confirmed") {
    modal.find('.modal-action').html('<form action="/bookings/confirm/'+ id +'" method="post"><div class="form-group"><label for="recipient-name" class="col-form-label">Choose Driver:</label><select class="form-control custom-select payment-status" id="driverList" name="driver" required></select></div><div class="row"><div class="col-md-6"><button type="submit" class="btn btn-success status-confirm">Confirm</button></form></div><div class="col-md-6"><form action="/bookings/cancel/'+ id +'" method="post"><button type="submit" class="btn btn-danger status-confirm">Cancel</button></form></div></div>');

    $( ".driver" ).each(function() {
      var driverName = $(this).val();
      var driverID = $(this).attr("data-id");
      $('select#driverList').append($('<option>', {
          value: driverID,
          text: driverName
      }));
    });


  } else if (getStatus == "Confirmed") {
    modal.find('.modal-action').html('<div class="row"><div class="col-md-12"><form action="/bookings/cancel/'+ id +'" method="post"><button type="submit" class="btn btn-danger status-confirm">Cancel</button></form></div></div>');
  } else {
    modal.find('.modal-action').html('<form action="/bookings/delete/'+ id +'" method="post"><input type="hidden" name="bookingID" value="<%= booking._id %>"><button type="submit" class="btn btn-danger status-confirm">Delete</button></form></form>');
  }

})

</script>
